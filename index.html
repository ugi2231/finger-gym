<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>손가락 운동 챌린지 (Finger Gym)</title>

<!-- Firebase SDK (v9 모듈버전) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics.js";

  // Firebase 설정값
  const firebaseConfig = {
    apiKey: "AIzaSyCkSm4Zq2LUIGQr-v5Ix1ony4GBZLGvwqA",
    authDomain: "finger-gym-de648.firebaseapp.com",
    projectId: "finger-gym-de648",
    storageBucket: "finger-gym-de648.appspot.com",
    messagingSenderId: "1093207272173",
    appId: "1:1093207272173:web:5a67893d026bbe2d0d7ae4",
    measurementId: "G-SSX4VGK20P"
  };

  // Firebase 초기화
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);

  // 랭킹 컬렉션 참조
  const rankingCol = collection(db, "rankings");

  // 랭킹 저장 함수
  async function saveRanking(nickname, score) {
    try {
      await addDoc(rankingCol, {
        nickname: nickname,
        score: score,
        timestamp: new Date()
      });
      console.log("랭킹 저장 성공!");
    } catch (e) {
      console.error("랭킹 저장 실패:", e);
    }
  }

  // 랭킹 불러오기 함수 (상위 100명)
  async function loadRanking() {
    const q = query(rankingCol, orderBy("score", "desc"), limit(100));
    const querySnapshot = await getDocs(q);
    const rankingList = [];
    querySnapshot.forEach((doc) => {
      rankingList.push(doc.data());
    });
    return rankingList;
  }

  // DOMContentLoaded 후 실행
  document.addEventListener("DOMContentLoaded", () => {
    // 게임 변수, UI 등 초기화 코드 여기에 작성

    const nicknameInput = document.getElementById("nickname");
    const scoreDisplay = document.getElementById("score");
    const saveBtn = document.getElementById("saveBtn");
    const rankingContainer = document.getElementById("ranking");

    // 저장 버튼 클릭 시 랭킹 저장
    saveBtn.addEventListener("click", async () => {
      const nickname = nicknameInput.value.trim();
      const score = parseInt(scoreDisplay.textContent, 10);

      if (!nickname) {
        alert("닉네임을 입력해주세요.");
        return;
      }
      if (isNaN(score) || score <= 0) {
        alert("유효한 점수가 아닙니다.");
        return;
      }

      await saveRanking(nickname, score);
      alert("랭킹이 저장되었습니다!");

      // 저장 후 랭킹 새로 불러오기
      const rankingList = await loadRanking();
      displayRanking(rankingList);
    });

    // 랭킹 화면 표시 함수
    function displayRanking(list) {
      rankingContainer.innerHTML = "";
      list.forEach((item, index) => {
        const div = document.createElement("div");
        div.textContent = `${index + 1}위: ${item.nickname} - 점수: ${item.score}`;
        rankingContainer.appendChild(div);
      });
    }

    // 처음 페이지 로드 시 랭킹 불러오기
    loadRanking().then(displayRanking);
  });
</script>

<style>
  /* 간단한 기본 스타일 */
  body {
    font-family: Arial, sans-serif;
    padding: 1em;
    max-width: 480px;
    margin: auto;
  }
  #ranking div {
    padding: 4px 0;
    border-bottom: 1px solid #ddd;
  }
</style>
</head>

<body>
<h1>손가락 운동 챌린지 (Finger Gym)</h1>

<label for="nickname">닉네임:</label>
<input id="nickname" type="text" maxlength="10" placeholder="닉네임 입력" />

<div>
  <h2>점수: <span id="score">0</span></h2>
</div>

<button id="saveBtn">랭킹 저장하기</button>

<h2>랭킹 (상위 100명)</h2>
<div id="ranking"></div>

<!-- 실제 게임 화면, 점 터치 게임 UI는 이 아래에 추가하면 됩니다 -->

</body>
</html>